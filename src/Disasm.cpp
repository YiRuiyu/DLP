//
//Written on 12th, Aug, 2022
//Modified on 28th, Aug, 2022
//
//This file contains the function to disassambly the executable file

#include <iostream>
#include <string>
#include <vector>
#include <cstdlib>
#include <cstring>
#include "../include/Disasm.h"

static csh handle;

unsigned char* String_to_Hex(std::string instruct) // As the name, change the instruction from string to hex bits
{
    std::string::size_type pos;
    pos = 0;
    char temp;
    unsigned char* Code_Hex = new unsigned char[instruct.length()/2];
    while(instruct.length() != pos)
    {
        unsigned char Hex =std::stoi(instruct.substr(pos, 2).c_str(), 0, 16);
        Code_Hex[pos/2] = Hex;
        pos += 2;
    }
    
    return Code_Hex;
}


void print_string_hex(const char *comment, unsigned char *str, size_t len)//print the BinaryCode
{
	unsigned char *c;

	printf("%s\n", comment);
	for (c = str; c < str + len; c++) {
		printf("0x%02x ", *c & 0xff);
	}

	printf("\n");
}

void print_insn_detail(cs_insn *ins)//Print the instruction detail
{
	int i;
	int n;
	cs_riscv *riscv;
	cs_detail *detail;

	// detail can be NULL on "data" instruction if SKIPDATA option is turned ON
	if (ins->detail == NULL)
		return;

	riscv = &(ins->detail->riscv);
	detail = ins->detail;
	if (riscv->op_count)
		printf("\top_count: %u\n", riscv->op_count);

	for (i = 0; i < riscv->op_count; i++) {
		cs_riscv_op *op = &(riscv->operands[i]);
		switch((int)op->type) {
			default:
				printf("\terror in opt_type: %u\n", (int)op->type);
				break;
			case RISCV_OP_REG:
				printf("\t\toperands[%u].type: REG = %s\n", i, cs_reg_name(handle, op->reg));
				break;
			case RISCV_OP_IMM:
				printf("\t\toperands[%u].type: IMM = 0x%" PRIx64 "\n", i, op->imm);
				break;
			case RISCV_OP_MEM:
				printf("\t\toperands[%u].type: MEM\n", i);
				if (op->mem.base != RISCV_REG_INVALID)
					printf("\t\t\toperands[%u].mem.base: REG = %s\n",
							i, cs_reg_name(handle, op->mem.base));
				if (op->mem.disp != 0)
					printf("\t\t\toperands[%u].mem.disp: 0x%" PRIx64 "\n", i, op->mem.disp);

				break;
		}

	}
	
	//print the groups this instruction belongs to
	if (detail->groups_count > 0) {
		printf("\tThis instruction belongs to groups: ");
		for (n = 0; n < detail->groups_count; n++) {
			printf("%s ", cs_group_name(handle, detail->groups[n]));
		}
		printf("\n");
	}

	printf("\n");
}


void printInsts(cs_insn *insn_, size_t count_)
{
  size_t j;
  for (j = 0; j < count_; j++) {
		printf("0x%" PRIx64 ":\t%s\t%s\t%d\n", insn_[j].address, insn_[j].mnemonic, insn_[j].op_str, insn_[j].id);
		print_insn_detail(&insn_[j]);
	}
}


cs_insn* Disasm(unsigned char* Code_, uint64_t address_, size_t length_, size_t &count_)
{
	struct platform platriscv = {
			CS_ARCH_RISCV,
			CS_MODE_RISCV32,
			Code_,
			length_,
			"riscv"
	};
	cs_insn *insn;
	cs_err err = cs_open(platriscv.arch, platriscv.mode, &handle);
	if (err) {
		printf("Failed on cs_open() with error returned: %u\n", err);
		return nullptr;
	}
	cs_option(handle, CS_OPT_DETAIL, CS_OPT_ON); 
	count_ = cs_disasm(handle, platriscv.code, platriscv.size, address_, 0, &insn);
	if (count_) {
		
		return insn;

	} else {
		printf("****************\n");
		printf("Platform: %s\n", platriscv.comment);
		print_string_hex("Code:", platriscv.code, platriscv.size);
		printf("ERROR: Failed to disasm given code!\n");
		return nullptr;
	}

}


int testdisasm (void)
{
	size_t count;//used as iterator
    cs_insn *insn;//pointing at the instructions
    std::string Code = "130101ff93050000232481002326110013040500ef00c07203a501038327c50363840700e780070013050400ef208068930700006388070037150100130505fd6f20c00c67800000973100009381417113854104138641083306a64093050000ef00401e172500001305850a63080500171500001305c5eaef204009ef00c012032501009305410013060000ef0000096ff01ff79387010313870103630af70093070000638607001385010367800700678000009387010393850103b385f54093d7254093d5f501b385f50093d51540638a05009307000063860700138501036780070067800000130101ff2324810083c781052326110063980700eff09ff993071000238cf1048320c1000324810013010101678000006ff0dff9130101fe232e1100232c810013040102b7676c6c938787542320f4feb727576f9387f7062322f4feb7776400938727c72324f4fe232604fe6f0080028327c4fe938707ffb387870083c707ff13850700ef00c01b8327c4fe938717002326f4fe8327c4fe938707ffb387870083c707ffe39607fc93070000138507008320c101032481011301010267800000130101ff23248100b73701003734010023202101938707001307040023261100232291003389e7406382e702135929401304040093040000832704009384140013044400e7800700e3e824ff37340100b737010093878700130704003389e740135929406380e7021304040093040000832704009384140013044400e7800700e3e824ff8320c10003248100832441000329010013010101678000001303f00013070500637ec3029377f7006390070a63920508937606ff1376f600b386e6002320b7002322b7002324b7002326b70013070701e366d7fe6314060067800000b306c3409396260097020000b38656006780c6002307b700a306b7002306b700a305b7002305b700a304b7002304b700a303b7002303b700a302b7002302b700a301b7002301b700a300b7002300b7006780000093f5f50f93968500b3e5d50093960501b3e5d5006ff0dff69396270097020000b386560093820000e78006fa93800200938707ff3307f7403306f600e378c3f66ff0dff3032685006f00800183a781039305050003a68700138507006f004000130101fe232c2101232e110013090500630605008327850363860704832786009387f7ff2324f60063dc07000327860163c6e70493f7f50f1307a0006380e7048327060013f5f50f138717002320e6002380b7008320c1010329810113010102678000002326c1002324b100ef0050330326c100832581006ff05ffa8320c1011305090003298101130101026f00000b130101ff2320210103a9810323248100232291002326110093040500138405006306090083278903638a0704832784009387f7ff2324f40063dc07000327840163c4e70493f7f40f1307a000638ee7028327040013f5f40f138717002320e400238097008320c100032481008324410003290100130101016780000013050900ef0010296ff09ffa13060400032481008320c10093850400130509008324410003290100130101016f004000130101fe232c8100232a910023282101232e110023263101130905009384050013040600630605008327850363800714832784010317c4002324f400937787006382070883270401638e07069316270193f9f40f93f4f40f63da06080327040083264401b307f74063dad70a83268400130617002320c4009386f6ff2324d4002300370103274401938717006304f70c8357c40093f71700638607009307a000638af40a8320c10103248101032901018329c100138504008324410113010102678000009305040013050900ef00c00b631a05080317c40093f9f40f832704019316270193f4f40fe3ca06f683264406372600003367c70037e6ffff1306f6ffb3f6c6002316e400032704002322d40683264401b307f740e3cad7f49305040013050900ef000051631e0502032704008326840093071000130617009386f6ff2320c4002324d4002300370103274401e310f7f49305040013050900ef00804de30205f49304f0ff6ff0dff3ef00900f6ff01fec9307050003a5810313860500938507006ff0dfe783a78103130101ff23248100232291002326110093040500138405006386070003a78703630007088317c40013f7870063040708032704016300070a93f6170063880602832644012324040013050000b306d040232cd400630a07028320c1000324810083244100130101016780000093f627001306000063940600032644012324c40013050000e31a07fc13f70708e30607fc93e707042316f4001305f0ff6ff0dffb13850700ef0050038317c40013f78700e31007f813f70701630a070613f74700631c07020327040193e787002316f400e31407f693f6072813060020e38ec6f49305040013850400ef00d0608317c400032704016ff05ff483250403638e0500130704046388e50013850400ef0090198317c400232804020327040193f7b7fd232204002320e4006ff01ffa1307900023a0e40093e707046ff0dff5130101fd232c410103aa0103232021032326110203298a142324810223229102232e3101232a510123286101232671012324810163000904130b0500938b0500930a10009309f0ff832449001384f4ff6342040293942400b304990063840b0483a74410638077051304f4ff9384c4ffe31634ff8320c1020324810283244102032901028329c101032a8101832a4101032b0101832bc100032c810013010103678000008327490083a644009387f7ff638e870423a20400e38806fa8327891833978a00032c4900b377f70063920702e78006000327490083278a1463148701e38427f9e38807f8138907006ff0dff58327c91883a544083377f700631c070013050b00e78006006ff0dffc232289006ff09ffa13850500e78006006ff09ffb8397c500130101fe232c810023263101232e1100232a91002328210113f78700138405009309050063120712371700001307078083a6450033e7e7002396e5006358d018032884026302080e93d7c70083a4090093f7170023a009008325c40163900718130600009306100013850900e70008009307f0ff130605006300f51a0317c400032884028325c40113774700630e070003274400832704033306e640638607008327c4033306f6409306000013850900e70008009307f0ff6316f51283a609009307d00163eed70c3707c0df1307e7ff3357d740137717008317c4006314070c0326040137f7ffff1307f77f33f7e70093d7c7002316e400232204002320c40093f71700639c07128325040323a09900638c0500930704046386f50013850900ef00407223280402130500008320c1010324810183244101032901018329c100130101026780000003a90501e30e09fc83a4050093f7370023a02501b3842441130700006394070003a745012324e400634890006ff05ffb3309a900e35690fa832744028325c401938604001306090013850900e7800700b384a440e34ea0fc8317c40093e707048320c1012316f4000324810183244101032901018329c1001305f0ff130101026780000083a6c503e348d0e6130500006ff05ff5032604056ff09fea8317c4008326040137f7ffff1307f77f33f7e70093d7c7002316e400232204002320d40093f71700e38e07ee2328a4046ff05fef83a70900e38007e61307d0016386e70013076001e39ae7f623a09900130500006ff05fefe39606ec2328a4046ff05fec130101fe232c8100232e1100130405006306050083278503638007028397c500639607028320c101032481011305000013010102678000002326b100ef00403f8325c1008397c500e38e07fc13050400032481018320c101130101026ff09fd563060506130101fe232c81001304050003a58103232e11006306050083278503638a07028317c400639c07008320c1010324810113050000130101026780000093050400032481018320c101130101026ff05fd02326a100ef0080378317c4000325c100e38407fc6ff09ffd03a50103b7150100938505b66f00100c1305000067800000b7250100938505236f00d00a1305000067800000130101feb7170100232e1100232c8100232a9100232821012326310123244101232251012320610103244500938747c4232ef5021307c52e930730002324e52e2322f52e2320052e93074000130905002326f40013068000930500002320040023220400232404002322040623280400232a0400232c04001305c405eff04fe2372b010083248900b72a0100372a0100b7290100130bcbfe938a0a05130a8a0d93890915b707010023206403232254032324440323263403232e84009387970023a6f400130680009305000023a0040023a2040023a4040023a2040623a8040023aa040023ac04001385c405eff04fdb0324c900b707020023a0640323a2540323a4440323a6340323ae9400938727012326f4002320040023220400232404002322040623280400232a0400232c04001305c4051306800093050000eff04fd68320c10123206403232254032324440323263403232e84000324810193071000232cf90283244101032901018329c100032a8100832a4100032b01001301010267800000130101ff9387f5ff23248100139417003304f400131424003304f400131434002320210113890500930544072322910023261100ef00502093040500630005021305c50023a0040023a2240123a4a4001306840693050000eff04fcc8320c100032481000329010013850400832441001301010167800000130101fe2328210103a9010323263101232e110083278903232c8100232a9100930905006386070a1309092e9304f0ff83274900032489009387f7ff63d807006f00000813048406638c97060317c4009387f7ffe31807feb707ffff938717002326f4002322040623200400232404002322040023280400232a0400232c040013068000930500001305c405eff08fc123280402232a040223220404232404048320c101130504000324810183244101032901018329c100130101026780000003240900630c0400130904006ff05ff613050900eff01fd36ff01ff59305c01a13850900ef00d00d13040500630805021305c50093074000232004002322f4002324a4001306001a93050000eff08fb923208900130904006ff09ff1232009009307c00023a0f9006ff09ff703a50103b7250100938505236f00c0568327850363840700678000006ff0dfcb6780000067800000678000006780000003a58103b71501009385c5c36f00804903a58103b7150100938505c56f008048130101ff23248100b737010037340100938787001304c4003304f440232291002326110093542440638004021304c4ff3304f400832704009384f4ff1304c4ffe7800700e39804fe8320c10003248100832441001301010167800000130101fe23263101232c8100232a91002328210123244101232e1100138a050013090500938981c2ef00507303a78900b71700001384f7fe8324470093f4c4ff33848400330444411354c4001304f4ff1314c400634ef4009305000013050900ef00507083a78900b38797006308f50213050900ef00d06e8320c1010324810183244101032901018329c100032a8100130500001301010267800000b305804013050900ef00106c9307f0ff6308f5049387c10503a7070083a68900b384844093e41400330787401305090023a2960023a0e700ef00d0688320c1010324810183244101032901018329c100032a81001305100013010102678000009305000013050900ef00106603a789009306f000b307e540e3def6f483a6c10393e717002322f7003305d54023aea1046ff05ff4638e0516130101ff2324810023229100138405009304050023261100ef0010610325c4ff130784ff9377e5ff3306f700938581c28326460003a8850093f6c6ff630ec8182322d600137515003308d600631e0508032384ff032848003307674083288700138501c3b3876700137818006380a8140323c70023a66800232413016304081a93e617002322d7002320f6009306f01f63ecf60693f687ff9386860003a54500b386d50003a6060013d8570093071000b3970701b3e7a700138586ff2326a7002324c70023a2f50023a0e6002326e600032481008320c1001385040083244100130101016f00905403254800137515006306050893e61700232ed4fe2320f6009306f01fe3f8f6f893d6970013064000636ed61093d667001385960313868603131535003385a50083260500130585ff6318d5006f00001583a686006308d50003a646001376c6ffe3e8c7fe03a5c6002326a7002324d700032481002324e5008320c100138504008324410023a6e600130101016f00904b67800000b387d700138501c383268600638ca60c0328c60013e517003306f70023a606012324d8002322a7002320f6006ff05fee631c0812832586000326c600b386f60093e7160023a6c5002324b6002322f7003307d7002320d7006ff0dfef13751500b386d70063100502032584ff3307a7408327c70003268700b386a6002326f60023a4c70013e6160083a701042322c70023a4e500e3e0f6ec83a5c10413850400eff01fcb6ff01febb387d7006ff0dff5130640016370d602130640056364d60693d6c7001385f6061386e606131535006ff09fed1385c6051386b605131535006ff09fec23aae50023a8e50093e617002326a7002324a7002322d7003307f7002320f7006ff01fe503a845001356264093071000b397c700b3e7070123a2f5006ff05feb13064015636cd60093d6f7001385860713867607131535006ff0dfe613064055636cd60093d627011385d6071386c607131535006ff01fe51305803f1306e0076ff05fe493e617002322d7002320f6006ff01fde130101fe2328210123263101232441012322510123206101232e1100232c8100232a9100138b0500930a052e130a0000930910001309f0ff83a44a0003a48a009384f4ff63c604028357c4009384f4ff63fcf9008317e4001305040063862701e7000b00336aaa0013048406e39e24fd83aa0a00e3920afc8320c1010324810183244101032901018329c100832a4100032b010013050a00032a81001301010267800000130101fd23202103232e3101232c4101232a51012328610123267101232611022324810223229102930a0500938b0500130b052e130a0000930910001309f0ff83244b0003248b009384f4ff63c804028357c4009384f4ff63fef9008317e4009305040013850a0063862701e7800b00336aaa0013048406e39c24fd032b0b00e3100bfc8320c1020324810283244102032901028329c101832a4101032b0101832bc10013050a00032a810113010103678000008397c500130101f8232c8106232e1106232a910623282107232631072324410713f7270013840500630c07029387350423a0f50023a8f5009307100023aaf5008320c1070324810783244107032901078329c106032a810613010108678000008395e5009304050063cc050813068100ef001053634405088327c10037f90000b71900003379f900b7e7ffff3309f90013391900130a00409389098093050a0013850400ef00401c8317c400630e050637170100130747c423aee40293e707082316f4002320a4002328a400232a440163180908b3e737018320c1072316f4000324810783244107032901078329c106032a810613010108678000008317c40093f707081309000063860704130a000493050a0013850400ef0000158317c40093090000e31605f813f70720e31a07f093f7c7ff93e72700130734042316f400930710002320e4002328e400232af4006ff01fef130a0040930900006ff01ff48315e40013850400ef00d049631605008317c4006ff01ff68357c40093f7c7ff93e717009397070193d707416ff09ff4130101f923248106138405008395e500232291062320210723261106930406001389060063ca050413068100ef00503e634405040327c100b7f700008320c106b3f7e70037e7ffffb387e7000324810693b717002320f9001307004023a0e4003715000083244106032901061305058013010107678000008357c40093f70708638807028320c10603248106930700002320f9001307000423a0e40003290106832441061305000013010107678000008320c106032481062320f9001307004023a0e4000329010683244106130500001301010767800000130101fd232e310123261102232481022322910223202103232c4101232a5101232861012326710123248101232291019387b5001307600193090500636cf7089307000163eab720ef00c072930400019307800193052000138981c2b307f90003a44700138787ff6300e430832744008326c4000326840093f7c7ffb307f40003a747002326d60023a4c600136717001385090023a2e700ef00006e130584008320c1020324810283244102032901028329c101032a8101832a4101032b0101832bc100032c8100832c4100130101036780000093f487ff63c0071863eeb416ef0040699307701f63fa973893d79400638c0716130740006360f72e93d76400938597031385870393963500138981c2b306d90003a44600938686ff638686021306f0006f000001635a07220324c400638c86008327440093f7c7ff33879740e354e6fe9305050003240901138801c3630e041d832744009306f00093f7c7ff3387974063c2e632232a0901232809016356072e1307f01f03254900636ef71e13f787ff130787003307e9008326070013d6570093071000b397c7003365f500930787ff2326f4002324d4002322a9002320870023a6860093d72540130610003316f600636ac50ab377a600639407021316160093f5c5ffb377a60093854500639a070013161600b377a60093854500e38a07fe9308f0001393350033036900130503008327c500138e05006308f51e03a747001384070083a7c7001377c7ffb306974063c8d81ee3c206fe3307e40083264700032684001385090093e616002322d7002326f60023a4c700ef00c052130584006ff0dfe49307c00023a0f900130500006ff0dfe393060020930500041305f0036ff09fe9032489008327440013fbc7ff63689b0033079b409307f00063c2e70a83aac10403a7c1039307f0ff330a6401b38a54016304f73ab71700009387f700b38afa00b7f7ffffb3fafa0093850a0013850900ef00404b9307f0ff930b05006304f52063604521138cc10583250c00b385ba002320bc00138705006316aa289317450163920728832b8900b3075b0193e7170023a2fb0083a6810463f4b60023a4b10483a6410463f4b60023a2b10413840b006f00c01b032549006ff09fe893e714002322f400b304940023249900136717001385090023a2e400ef008042130584006ff09fd48326c400032684006ff09fd103a4c70093852500e38c87dc6ff09fcf13d797009306400063f2e6149306400163eae6301306c7059306b705131636003306c90003270600130686ff6318e6006f00002b032787006308e6008326470093f6c6ffe3e8d7fe0326c7002326c4002324e40023248600232687006ff05fde130740016376f71213074005636af72c93d7c4009385f7061385e706939635006ff05fd1130e1e0093773e0013058500638e07108327c5006ff0dfdf0326840093e514002322b4002326f60023a4c700b3049400232a99002328990093e7160023a6040123a4040123a2f4003307e400138509002320d700ef008032130584006ff09fc4b307f40003a74700138509001367170023a2e700ef008030130584006ff09fc293d53400938784006ff05fbd93e614002322d400b3049400232a9900232899009366170023a6040123a4040123a2d400b307f4001385090023a0e700ef00002c130584006ff01fbe13d767001306970393068703131636006ff05fec630a2409032489008327440093f7c7ff3387974063e697009307f000e3c0e7e413850900ef00c027130500006ff0dfb99385c7051385b705939635006ff09fbf832783009385f5ff6396672493f73500130383ffe39607fe032749009347f6ffb3f7e7002322f90013161600e3eac7d2e30806d23377f600631a0700131616003377f600130e4e00e30a07fe93050e006ff01fc9138cc10503270c003387ea002320ec0083a6c1039307f0ff6388f614b3874b41b387e7002320fc0093fc7b00638c0c0c37170000b38b9b4193058700938b8b00b3859541b38a5b01b38555411307f7ff33fae50093050a0013850900ef00401b9307f0ff6308f51433057541b30a450103270c002324790193e71a00b305ea002320bc0023a2fb00e30c24d19306f00063f0660f0327440093074bff93f787ff137717003367f7002322e400130650003307f4002322c7002324c70063e6f60083a74b006ff0dfcd9305840013850900eff0cfb0832b890083250c0083a74b006ff01fcc938a0a016ff0dfc693d6264093071000b397d7003365f5002322a9006ff09fd5b3855b01b305b0409395450113da450193050a0013850900ef00400f9307f0ffe312f5f4130a00006ff05ff49306400563e4e60413d7c7001306f7069306e706131636006ff05fce130740156364f70493d7f4009385870713857707939635006ff0dfa323ae71036ff0dfeb9307100023a2fb006ff05fe19306401563e4e60413d7f7001306870793067707131636006ff09fc9130740556364f70493d724019385d7071385c707939635006ff01f9f938c8cffb38a9a01b38a7a41130a00006ff0dfea9306405563e4e60213d727011306d7079306c707131636006ff0dfc49306803f9305f0071305e0076ff01f9b1306803f9306e0076ff01fc3832749006ff01fdd6780000067800000130101ff232481002322910013040500138505002326110023a80104ef0050119307f0ff630cf5008320c1000324810083244100130101016780000083a70105e38407fe8320c1002320f40003248100832441001301010167800000130101ff23248100138405008395e50023261100ef00404763400502832704058320c100b387a7002328f4040324810013010101678000008357c40037f7ffff1307f7ffb3f7e7008320c1002316f40003248100130101016780000013050000678000008397c500130101fe232c8100232a91002328210123263101232e110013f70710138405009304050013090600938906006310070437f7ffff1307f7ffb3f7e7008315e4002316f400032481018320c10193860900130609008329c100032901011385040083244101130101026f00c0098395e5009306200013060000ef0000348317c4006ff01ffb130101ff23248100138405008395e50023261100ef0000329307f0ff6308f5028357c400371700008320c100b3e7e7009397070193d707412328a4042316f4000324810013010101678000008357c40037f7ffff1307f7ffb3f7e7009397070193d707418320c1002316f4000324810013010101678000008395e5006f000008130101ff138705002324810023229100930506001304050013860600130507002326110023a80104ef00807b9307f0ff630cf5008320c1000324810083244100130101016780000083a70105e38407fe8320c1002320f40003248100832441001301010167800000930505009306000013060000130500006f00c04b130101ff232481002322910013040500138505002326110023a80104ef0040539307f0ff630cf5008320c1000324810083244100130101016780000083a70105e38407fe8320c1002320f40003248100832441001301010167800000130101ff232611002324810023229100232021016380050213840500930405006306050083278503638c070a8317c400639207028320c100032481001309000083244100130509000329010013010101678000009305040013850400efe08fe88327c40213090500638a07008325c40113850400e7800700634c05068357c40093f70708639e070683250403638c0500930704046386f50013850400efe01fe923280402832544046388050013850400efe0dfe723220404efe09fcb23160400efe05fcb8320c100032481008324410013050900032901001301010167800000efe01fc88317c400e38607f46ff09ff68357c4001309f0ff93f70708e38607f88325040113850400efe05fe26ff0dff79305050003a581036ff09fee130101ff1387050023248100232291001304050093050600130507002326110023a80104ef0080429307f0ff630cf5008320c1000324810083244100130101016780000083a70105e38407fe8320c1002320f40003248100832441001301010167800000130101ff232481002322910013040500138505002326110023a80104ef00c0429307f0ff630cf5008320c1000324810083244100130101016780000083a70105e38407fe8320c1002320f40003248100832441001301010167800000130101ff138705002324810023229100930506001304050013860600130507002326110023a80104ef0040409307f0ff630cf5008320c1000324810083244100130101016780000083a70105e38407fe8320c1002320f40003248100832441001301010167800000130101ff138705002324810023229100930506001304050013860600130507002326110023a80104ef00003e9307f0ff630cf5008320c1000324810083244100130101016780000083a70105e38407fe8320c1002320f40003248100832441001301010167800000130101fe2328210103a90500232c8100232a9100232e11002326310123244101138405009304050063020904832909006388090203aa0900630e0a0083250a0063840500eff0dffb93050a0013850400efe01fc39385090013850400efe05fc29305090013850400efe09fc193050400032481018320c101032901018329c100032a81001385040083244101130101026fe01fbf83a78103638aa7108325c504130101fe232a9100232e1100232c8100232821012326310193040500638005041309000093090008b387250103a40700630e0400930504000324040013850400efe01fbae31804fe83a5c40413094900e31c39fd13850400efe09fb883a504046386050013850400efe09fb703a48414630004021389c414630c2401930504000324040013850400efe09fb5e31889fe83a544056386050013850400efe05fb483a784036386070483a7c40313850400e780070003a4042e630c0402832504006386050013850400eff09fe993050400032481018320c101032901018329c1001385040083244101130101026fe05faf8320c1010324810183244101032901018329c10013010102678000006780000003a7010383278714638c070403a747001308f001634ee8061318270063060502338307012324c30883a88718130610003316e600b3e8c80023a417192324d310930620006304d5021307170023a2e700b387070123a4b70013050000678000009307c7142324f7146ff05ffa83a6c7181307170023a2e700b3e6c60023a6d718b387070123a4b70013050000678000001305f0ff67800000130101ff2326110023248100930890037300000013040500634c05008320c1001305040003248100130101016780000033048040ef00c02c232085001304f0ff6ff0dffd9308d00573000000634405006f000000130101ff23248100130405002326110033048040ef008029232085006f000000130101f72322910823261108938405002324810893080005930501007300000013040500634405021385040093050100ef00401b8320c108130504000324810883244108130101096780000033048040ef00c023232085001304f0ff6ff0dffc130101f99305810023261106eff05ff99307f0ff630ef5000325c1008320c1061355d5001375150013010107678000008320c106130500001301010767800000130101ff23261100232481009308e0037300000013040500634c05008320c1001305040003248100130101016780000033048040ef00801b232085001304f0ff6ff0dffd130101ff23261100232481009308f0037300000013040500634c05008320c1001305040003248100130101016780000033048040ef004017232085001304f0ff6ff0dffd03a74105130101ff2326110093070500631007029308600d13050000730000001306f0ff13070500630ac50223aaa1049308600d3385e7007300000003a74105b387e700631cf5008320c10023aaa104130507001301010167800000ef0080108320c1009307c0002320f5001305f0ff1301010167800000130101ff2326110023248100930800047300000013040500634c05008320c1001305040003248100130101016780000033048040ef00800b232085001304f0ff6ff0dffd03d7850183d74501130101ff83a2c50183af050203af050383ae050403ae850303a3850483a3c50403a8850583a8c505232681002324910003a4050183a485002322210103a9050003a6850613170701b3e7e70083a6c5062310250123119500232285002324f500231655002317f5012328e5012326d5052324c505232c6500232e75002324050323261503232cc5020324c100232ed5028324810003294100130101016780000003a5810367800000";
    unsigned char* Code_Hex = nullptr;
    uint64_t address = 65716;

    //Transform the Code into the Capstone form
    Code_Hex = String_to_Hex(Code);

    print_string_hex("This is the hex stream of Code: ", Code_Hex, Code.length()/2);

    //Disassemblying the bit stream
    insn = Disasm(Code_Hex, address, Code.length()/2, count);

    //test the function Disasm
    printInsts(insn, count);


    return 0;
}